<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rmovies</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>
body {
  margin:0;
  font-family: 'Roboto', sans-serif;
  background:#000;
  color:#fff;
}

/* Navbar */
.navbar {
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:8px 20px; 
  background: rgba(255, 105, 180, 0.3);
  backdrop-filter: blur(8px);
  flex-wrap: wrap;
  font-size: 0.9em;
}
.navbar .logo { font-weight:700; font-size:1.2em; color:#ff69b4; }
.nav-controls { display:flex; flex-wrap: wrap; gap:10px; }
.nav-controls input { flex: 1 1 150px; min-width: 120px; padding:6px; border-radius:4px 0 0 4px; border:none; outline:none; font-size:0.9em; }
.nav-controls select, .nav-controls button { flex: 0 1 auto; padding:6px 10px; border:none; border-radius:0 4px 4px 0; cursor:pointer; font-weight:600; font-size:0.9em; background:#ff69b4; color:#000; }
.nav-controls button:hover, .nav-controls select:hover { background:#ff85c1; }

@media (max-width: 600px) {
  .nav-controls { flex-direction: column; gap: 8px; }
  .nav-controls input, .nav-controls select, .nav-controls button { width: 100%; border-radius: 5px; }
}

/* Banner */
.banner {
  position:relative;
  width:100%;
  height:75vh;
  background-size:cover;
  background-position:center;
  display:flex;
  align-items:flex-end;
  padding:20px;
  border-radius:10px;
  color:#fff;
  transition: background-image 1s ease-in-out;
}
.banner-content { transition: transform 0.3s, opacity 0.3s; }
.banner-content:hover { transform: scale(1.02); opacity: 1; }
.banner-content h2 { font-size:2.5em; margin-bottom:10px; }
.banner-content p { max-width:700px; font-size:1.1em; margin-bottom:15px; }
.banner-content .trailer-btn { background:#ff69b4; color:#000; padding:10px 20px; border:none; border-radius:5px; cursor:pointer; font-weight:600; }
.banner-content .trailer-btn:hover { background:#ff85c1; }

/* Results */
.results { display:flex; flex-wrap:wrap; gap:15px; padding:20px; justify-content:center; margin-top:20px; }
.movie-card {
  background:#111;
  border-radius:10px;
  overflow:hidden;
  width:180px;
  transition: transform 0.3s;
  cursor:pointer;
  opacity: 0;
  transform: translateY(20px);
  animation: fadeInUp 0.5s forwards;
  position: relative;
}
.movie-card:hover { transform:scale(1.05); }
.movie-card img { width:100%; height:270px; object-fit:cover; display:block; border-radius:10px; }
.movie-card iframe { position:absolute; top:0; left:0; width:100%; height:270px; object-fit:cover; display:none; border-radius:10px; }
.movie-card h3 { margin:5px; font-size:1em; }
.movie-card p { margin:5px; font-size:0.9em; }
.movie-card .trailer-btn { width:calc(100% - 10px); margin:5px; padding:5px; background:#ff69b4; color:#000; border:none; border-radius:5px; cursor:pointer; font-weight:600; }
.movie-card .trailer-btn:hover { background:#ff85c1; }

@keyframes fadeInUp { to { opacity:1; transform:translateY(0); } }

/* Modal */
#modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); justify-content:center; align-items:center; z-index:10000; }
#modal-content { background:#111; padding:20px; border-radius:10px; max-width:800px; width:90%; max-height:80%; overflow:auto; position:relative; }
#close-modal { position:absolute; top:10px; right:10px; font-size:1.5em; cursor:pointer; }
#modal iframe { width:100%; height:400px; border:none; border-radius:10px; }
</style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar">
  <div class="logo">Rmovies</div>
  <div class="nav-controls">
    <input type="text" id="search-input" placeholder="Search movies or TV shows">
    <select id="genre-select"><option value="">All Genres</option></select>
    <button id="search-btn">Search</button>
  </div>
</nav>

<!-- Banner -->
<div id="banner" class="banner">
  <div class="banner-content">
    <h2 id="banner-title"></h2>
    <p id="banner-overview"></p>
    <button id="banner-trailer" class="trailer-btn">Play Trailer</button>
  </div>
</div>

<!-- Results -->
<div id="results" class="results"></div>

<!-- Modal -->
<div id="modal">
  <div id="modal-content">
    <span id="close-modal">&times;</span>
    <div id="modal-body"></div>
  </div>
</div>

<script>
const apiKey = 'b280498b058330987e267655eeb548f2';
const searchBtn = document.getElementById('search-btn');
const searchInput = document.getElementById('search-input');
const results = document.getElementById('results');
const modal = document.getElementById('modal');
const modalBody = document.getElementById('modal-body');
const closeModal = document.getElementById('close-modal');
const genreSelect = document.getElementById('genre-select');
const banner = document.getElementById('banner');
const bannerTitle = document.getElementById('banner-title');
const bannerOverview = document.getElementById('banner-overview');
const bannerTrailerBtn = document.getElementById('banner-trailer');

// Close modal
closeModal.addEventListener('click', ()=> modal.style.display='none');
window.addEventListener('click', e=>{ if(e.target==modal) modal.style.display='none'; });

// Fetch genres
async function fetchGenres(){
  const res = await fetch(`https://api.themoviedb.org/3/genre/movie/list?api_key=${apiKey}&language=en-US`);
  const data = await res.json();
  data.genres.forEach(g=>{
    const option = document.createElement('option');
    option.value=g.id; option.textContent=g.name;
    genreSelect.appendChild(option);
  });
}
fetchGenres();

// Fetch trending
async function fetchTrending(){
  const res = await fetch(`https://api.themoviedb.org/3/trending/movie/week?api_key=${apiKey}`);
  const data = await res.json();
  displayResults(data.results);
  if(data.results[0]) setBanner(data.results[0]);
}

// Display results with autoplay-on-hover
function displayResults(items){
  results.innerHTML='';
  items.forEach(item=>{
    if(!item.poster_path) return;
    const card = document.createElement('div');
    card.classList.add('movie-card');

    const img = document.createElement('img');
    img.setAttribute('data-src', `https://image.tmdb.org/t/p/w300${item.poster_path}`);
    img.alt = item.title || item.name;
    img.loading='lazy';
    card.appendChild(img);

    const video = document.createElement('iframe');
    video.setAttribute("allowfullscreen", true);
    video.setAttribute("allow", "autoplay; encrypted-media");
    video.style.display='none';
    card.appendChild(video);

    const title = document.createElement('h3'); title.textContent=item.title||item.name;
    const rating = document.createElement('p'); rating.textContent='Rating: '+item.vote_average;
    card.appendChild(title); card.appendChild(rating);

    const btn = document.createElement('button'); btn.className='trailer-btn'; btn.textContent='Watch Trailer';
    btn.addEventListener('click', e=>{ e.stopPropagation(); fetchTrailer(item); });
    card.appendChild(btn);

    // Hover autoplay (fetch only once)
    let trailerKey = null;
    card.addEventListener('mouseenter', async ()=>{
      if(!trailerKey){
        try{
          const type = item.media_type || (item.title ? "movie" : "tv");
          const res = await fetch(`https://api.themoviedb.org/3/${type}/${item.id}/videos?api_key=${apiKey}&language=en-US`);
          const data = await res.json();
          const trailer = data.results.find(v=>v.type==='Trailer' && v.site==='YouTube');
          if(trailer){ trailerKey = trailer.key; }
        }catch(err){ console.log(err); }
      }
      if(trailerKey){
        video.src=`https://www.youtube.com/embed/${trailerKey}?autoplay=1&mute=1&controls=0&loop=1&playlist=${trailerKey}`;
        video.style.display='block'; img.style.display='none';
      }
    });
    card.addEventListener('mouseleave', ()=>{
      video.removeAttribute('src');
      video.style.display='none'; img.style.display='block';
    });

    card.addEventListener('click', ()=> showModal(item));
    results.appendChild(card);

    const observer = new IntersectionObserver(entries=>{
      entries.forEach(entry=>{
        if(entry.isIntersecting){
          const lazyImg = entry.target;
          lazyImg.src = lazyImg.dataset.src;
          observer.unobserve(lazyImg);
        }
      });
    });
    observer.observe(img);
  });
}

// Modal
function showModal(item){
  modalBody.innerHTML=`
    <h2>${item.title || item.name}</h2>
    <p>${item.overview || 'No description available.'}</p>
    <p>Rating: ${item.vote_average}</p>
    <p>Release: ${item.release_date || item.first_air_date || 'N/A'}</p>
  `;
  modal.style.display='flex';
}

// Fetch trailer
async function fetchTrailer(item){
  const type=item.media_type || (item.title ? "movie" : "tv");
  try{
    const res=await fetch(`https://api.themoviedb.org/3/${type}/${item.id}/videos?api_key=${apiKey}&language=en-US`);
    const data=await res.json();
    const trailer=data.results.find(v=>v.type==='Trailer' && v.site==='YouTube');
    if(trailer){
      modalBody.innerHTML=`
        <h2>${item.title || item.name} - Trailer</h2>
        <iframe src="https://www.youtube.com/embed/${trailer.key}?autoplay=1" 
          allow="autoplay; encrypted-media" allowfullscreen></iframe>
        <button id="close-trailer" class="trailer-btn">Close Trailer</button>
      `;
      modal.style.display='flex';
      document.getElementById('close-trailer').addEventListener('click', ()=> modal.style.display='none');
    } else {
      modalBody.innerHTML=`<h2>${item.title || item.name}</h2><p>Trailer not available.</p>`;
      modal.style.display='flex';
    }
  }catch(err){ console.error(err); }
}

// Banner
async function setBanner(movie){
  const bannerImage=`https://image.tmdb.org/t/p/original${movie.backdrop_path||movie.poster_path}`;
  banner.style.opacity=0;
  setTimeout(()=>{ banner.style.backgroundImage=`url('${bannerImage}')`; banner.style.opacity=1; }, 300);
  bannerTitle.textContent=movie.title||movie.name;
  bannerOverview.textContent=movie.overview||'';
  bannerTrailerBtn.onclick=()=> fetchTrailer(movie);
}

// Search
searchBtn.addEventListener('click', ()=>{ const query=searchInput.value.trim(); if(query) fetchResults(query); });
searchInput.addEventListener('keypress', e=>{ if(e.key==='Enter'){ const query=searchInput.value.trim(); if(query) fetchResults(query); } });

// Fetch search
async function fetchResults(query){
  results.innerHTML='';
  const genreFilter=genreSelect.value;
  const res = await fetch(`https://api.themoviedb.org/3/search/multi?api_key=${apiKey}&language=en-US&query=${query}`);
  const data = await res.json();
  displayResults(data.results.filter(item=> !genreFilter || (item.genre_ids && item.genre_ids.includes(parseInt(genreFilter)))));
}

fetchTrending();
</script>
</body>
</html>
